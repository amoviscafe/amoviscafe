<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Amovis Cafe ‚Äì Order History</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
*{
  box-sizing:border-box;
  font-family:'Poppins',sans-serif;
}
body{
  margin:0;
  background:#020617;
  color:#fff;
}

/* ================= HEADER ================= */
header{
  background:linear-gradient(90deg,#7c3aed,#ec4899);
  padding:18px;
  text-align:center;
  font-size:22px;
  font-weight:800;
}

/* ================= FILTER ================= */
.filters{
  padding:16px;
  display:grid;
  grid-template-columns:1fr 1fr auto;
  gap:12px;
  background:#0f172a;
}
.filters input,.filters button{
  padding:10px;
  border-radius:10px;
  border:none;
}
.filters input{
  background:#1e293b;
  color:#fff;
}
.filters button{
  background:#22c55e;
  font-weight:700;
  cursor:pointer;
}

/* ================= SUMMARY ================= */
.summary{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:16px;
  padding:16px;
}
.card{
  background:#0f172a;
  padding:18px;
  border-radius:18px;
  text-align:center;
}
.card h3{
  margin:0;
  font-size:28px;
  color:#facc15;
}

/* ================= LIST ================= */
.list{
  padding:16px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(360px,1fr));
  gap:18px;
}
.order{
  background:#0f172a;
  border-radius:18px;
  padding:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.5);
  position:relative;
}

/* PLACE BADGE */
.place{
  position:absolute;
  top:-14px;
  left:50%;
  transform:translateX(-50%);
  background:linear-gradient(90deg,#22c55e,#16a34a);
  padding:8px 24px;
  border-radius:30px;
  font-weight:800;
  letter-spacing:1px;
}

/* ITEMS */
.items{
  margin-top:24px;
  font-size:14px;
}
.items div{
  display:flex;
  justify-content:space-between;
  margin:4px 0;
}

/* META */
.meta{
  font-size:12px;
  opacity:.8;
  margin-top:6px;
}

/* TOTAL */
.total{
  font-size:18px;
  font-weight:800;
  color:#22c55e;
  margin-top:8px;
}

/* DELETE */
.delete-btn{
  margin-top:10px;
  width:100%;
  padding:10px;
  border:none;
  border-radius:20px;
  background:linear-gradient(90deg,#ef4444,#dc2626);
  color:#fff;
  font-weight:700;
  cursor:pointer;
}

/* EMPTY */
.empty{
  text-align:center;
  margin-top:80px;
  opacity:.6;
}
</style>
</head>

<body>

<header>üìä AMOVIS CAFE ‚Äì ORDER HISTORY</header>

<div class="filters">
  <input type="date" id="from">
  <input type="date" id="to">
  <button onclick="applyFilter()">Apply</button>
</div>

<div class="summary">
  <div class="card">
    <h3 id="totalOrders">0</h3>
    <p>Total Orders</p>
  </div>
  <div class="card">
    <h3 id="totalSales">‚Çπ0</h3>
    <p>Total Sales</p>
  </div>
</div>

<div class="list" id="list"></div>
<div class="empty" id="empty" style="display:none">No Orders Found</div>

<!-- ================= FIREBASE ================= -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyBymiTjjqUN-AAspzoA_bOGUWOzEc9o3jA",
  authDomain: "amovis-cafe-booking.firebaseapp.com",
  projectId: "amovis-cafe-booking"
});

const db = firebase.firestore();
const list = document.getElementById("list");
const empty = document.getElementById("empty");
const totalOrdersEl = document.getElementById("totalOrders");
const totalSalesEl = document.getElementById("totalSales");

let allOrders=[];

/* ================= LOAD HISTORY ================= */
db.collection("orders")
.where("status","==","COMPLETED")
.orderBy("completedAt","desc")
.onSnapshot(snapshot=>{
  allOrders=[];
  snapshot.forEach(doc=>{
    allOrders.push({id:doc.id,...doc.data()});
  });
  render(allOrders);
});

/* ================= RENDER ================= */
function render(data){
  list.innerHTML="";
  let totalSales=0;

  if(!data.length){
    empty.style.display="block";
    totalOrdersEl.innerText=0;
    totalSalesEl.innerText="‚Çπ0";
    return;
  }
  empty.style.display="none";

  data.forEach(o=>{
    let place = (o.type && o.no) ? `${o.type.toUpperCase()} ${o.no}` : "UNKNOWN";

    let itemsHTML="";
    let orderTotal=0;

    for(let name in o.items){
      const i=o.items[name];
      const sub=i.price*i.qty;
      orderTotal+=sub;
      itemsHTML+=`
        <div>
          <span>${name} √ó ${i.qty}</span>
          <span>‚Çπ${sub}</span>
        </div>`;
    }

    totalSales+=orderTotal;

    list.innerHTML+=`
      <div class="order">
        <div class="place">${place}</div>

        <div class="items">${itemsHTML}</div>

        <div class="meta">
          üí≥ ${o.paymentMode || "-"} <br>
          üïí ${o.completedAt?.toDate().toLocaleString()}
        </div>

        <div class="total">‚Çπ${orderTotal}</div>

        <button class="delete-btn" onclick="deleteOrder('${o.id}')">
          ‚ùå DELETE ORDER
        </button>
      </div>`;
  });

  totalOrdersEl.innerText=data.length;
  totalSalesEl.innerText="‚Çπ"+totalSales;
}

/* ================= FILTER ================= */
function applyFilter(){
  const f=document.getElementById("from").value;
  const t=document.getElementById("to").value;

  let filtered=[...allOrders];

  if(f){
    const fd=new Date(f);
    filtered=filtered.filter(o=>o.completedAt?.toDate()>=fd);
  }
  if(t){
    const td=new Date(t);
    td.setHours(23,59,59,999);
    filtered=filtered.filter(o=>o.completedAt?.toDate()<=td);
  }
  render(filtered);
}

/* ================= DELETE ================= */
function deleteOrder(id){
  if(confirm("Delete this order permanently?")){
    db.collection("orders").doc(id).delete();
  }
}
</script>

</body>
</html>
